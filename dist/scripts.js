"use strict";angular.module("atwork.utils",["ngRoute","ngMaterial"]).factory("appStorage",function(){return{get:function(n){return localStorage.getItem(n)},set:function(n,o){return localStorage.setItem(n,o)},remove:function(n){return localStorage.removeItem(n)}}}).factory("appPromise",[function(){return function(n){var o=Q.defer();return n(o),o.promise}}]).factory("appLocation",["$location",function(n){return n}]).factory("appWebSocket",[function(n){var o={conn:{},connect:function(){var n=this,o=window.io();o.on("connect",function(){console.log("Connected")}),o.on("disconnect",function(){n.connect()}),this.conn=o},reconnect:function(){this.conn.close(),this.connect()},close:function(){this.conn.close()}};return o.connect(),o}]).factory("appToast",["$mdToast",function(t){return function(n){var o=t.simple().content(n).action("OK").highlightAction(!1).position("top right");t.show(o)}}]).factory("appDialog",["$mdDialog",function(n){return n}]).factory("appDesktop",["$rootScope",function(o){var t=0,i=0;return{notify:function(n){t=void 0!==n.notificationsCount?n.notificationsCount:t,i=void 0!==n.messagesCount?n.messagesCount:i,o.badges={messageBadge:i},window.fluid&&(window.fluid.dockBadge=t+i,parseInt(window.fluid.dockBadge)<=0?window.fluid.dockBadge=void 0:(window.fluid.playSound("Sosumi"),window.fluid.playSound("Purr")))}}}]).directive("setFocus",["$timeout","$parse",function(e,c){return{link:function(n,o,t){if($(window).width()<=600)return!0;var i=c(t.setFocus);n.$watch(i,function(n){!0===n&&e(function(){o[0].focus()},800)})}}}]);
"use strict";angular.module("atwork.system",["ngRoute","ngMessages","ngResource","angularFileUpload","atwork.utils","angular-loading-bar","ngAnimate"]),angular.module("atwork.system").factory("tokenHttpInterceptor",["appStorage",function(t){return{request:function(e){return e.headers.Authorization="Bearer "+t.get("userToken"),e}}}]).factory("appSearch",["$resource",function(e){var t=e("search/:keyword",{},{query:{isArray:!1}});return function(e){return t.query({keyword:e}).$promise}}]).config(["$httpProvider","$mdThemingProvider","cfpLoadingBarProvider",function(e,t,r){e.interceptors.push("tokenHttpInterceptor"),t.definePalette("amazingPaletteName",{50:"ffebee",100:"ffcdd2",200:"ef9a9a",300:"e57373",400:"ef5350",500:"f44336",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),t.theme("default").primaryPalette("amazingPaletteName").accentPalette("amazingPaletteName"),r.includeSpinner=!0,r.includeBar=!1}]);
"use strict";angular.module("atwork.settings",[]);
"use strict";angular.module("atwork.settings").controller("SettingsCtrl",["$scope","$rootScope","$routeParams","$timeout","appPosts","appAuth","appToast","appStorage","appLocation","appWebSocket","appUsersSearch","appSettings",function(s,t,e,n,a,o,r,i,p,c,u,g){g.fetch(function(t){s.systemSettings=t}),-1===o.getUser().roles.indexOf("admin")&&(r("Only an Administrator can change system's settings."),p.url("/")),s.save=function(t){new g.single(s.systemSettings).$save(function(t){t.success&&(r("Your settings are saved."),p.url("/"))})}}]);
"use strict";angular.module("atwork.settings").config(["$routeProvider","$locationProvider",function(t,e){t.when("/settings",{templateUrl:"/system/settings/views/settings.html",controller:"SettingsCtrl"}),e.html5Mode(!0)}]);
"use strict";angular.module("atwork.settings").factory("appSettings",["$resource","$rootScope",function(t,i){return{cache:{},single:t("system-settings/"),fetch:function(s){var n=this,r=n.single.get({},function(){for(var t in r.res.items){var e=r.res.items[t];n.cache[e.name]=e.value}return i.systemSettings=n.cache,!s||s(n.cache)})}}}]).factory("appSettingsValid",["appSettings","appLocation","$rootScope",function(t,e,s){return function(){return!!("/settings"===e.url()||"/logout"===e.url()||s.systemSettings&&s.systemSettings.domains&&s.systemSettings.workplace)||(e.url("/settings"),!1)}}]);
"use strict";angular.module("atwork.activities",["atwork.system"]);
"use strict";angular.module("atwork.blogs",["atwork.system"]);
"use strict";angular.module("atwork.chats",["atwork.system"]);
"use strict";angular.module("atwork.notifications",["atwork.system"]).run(["$rootScope","appLocation","appNotification","appWebSocket","appNotificationText",function(t,n,i,o,a){o.conn.on("notification",function(o){t.$broadcast("notification",o),t.$broadcast(o.notificationType,o),o&&(o.message=a(o).text,o.then=function(){o.postId?n.url("/post/"+o.postId):o.userId&&n.url("/profile/"+o.actor.username)},i.show(o))}),o.conn.on("system",function(o){t.$broadcast(o.notificationType,o)})}]);
"use strict";angular.module("atwork.posts",["atwork.system"]);
"use strict";angular.module("atwork.streams",["atwork.system"]);
"use strict";angular.module("atwork.users",["atwork.system"]).factory("appAuth",["$http","appStorage",function(e,t){return{isLoggedIn:function(){return t.get("userToken")},getToken:function(){return t.get("userToken")},refreshUser:function(n){e.get("/users/me").then(function(e){null==e.res&&(e=e.data);var r=angular.toJson(e.res.record);t.set("user",r),n(e.res.record)})},getUser:function(){var e=t.get("user");return e?angular.fromJson(e):{name:"unknown"}}}}]);
"use strict";angular.module("atwork.activities").controller("ActivitiesCtrl",["$scope","$rootScope","$routeParams","$timeout","appPosts","appActivities","appAuth","appToast","appStorage","appLocation","appWebSocket",function(t,a,e,o,s,i,c,p,r,n,d){t.lastUpdated=0,t.newActivitiesCount=0,t.actions=[];var u=e.userId,l=i.get({userId:u,timestamp:t.lastUpdated},function(){t.actions=l.res.records?l.res.records.concat(t.actions):t.actions,t.lastUpdated=Date.now()})}]);
"use strict";angular.module("atwork.blogs",["summernote"]).controller("BlogsCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appBlogs","appBlogsFeed","resolvedBlogs",function(e,t,o,n,i,a,l,d,s,r,m,c){e.content="",e.lastUpdated=0,e.postForm="",e.newFeedCount=0,e.feed=[],e.feedsFilter="",e.limitComments=!0,e.feedPage=0,e.showBack=!1,e.mentionsResults=[],e.options={height:300,focus:!0,airMode:!1,toolbar:[["edit",["undo","redo"]],["headline",["style"]],["style",["bold","italic","underline","superscript","subscript","strikethrough","clear"]],["fontface",["fontname"]],["textsize",["fontsize"]],["fontclr",["color"]],["alignment",["ul","ol","paragraph","lineheight"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]]},e.content="Hello World",e.title="",angular.extend(e,c.config),function(t){console.log("inside update");var o=t.config||{};e.feedsFilter&&!o.append&&(e.feed=[]);o.append?e.feed=e.feed.concat(t.res.records):e.feed=t.res.records.concat(e.feed);e.noMorePosts=!t.res.morePages,e.lastUpdated=Date.now(),e.showBack=!1,e.timelinePage&&(e.feedTitle="Blogs")}(c),e.create=function(t,o){t&&new r.single({title:this.title,short_title:this.title.substr(1,20),content:this.content,short_desc:this.content.substr(1,50)}).$save(function(t){t.success?(t.res=angular.extend(t.res,{creator:i.getUser()}),console.log("response",t.res)):(e.failure=!0,a(t.res.message))})}}]).controller("AddBlogCtrl"[function(t,o,e,n,i,a,l,d,s,r){t.title="Hello World"}]),angular.module("textAngularEditor",["textAngular","ngMaterial"]).config(["$provide",function(t){t.decorator("taOptions",["$delegate",function(t){return t.forceTextAngularSanitize=!0,t.keyMappings=[],t.toolbar=[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["html","insertImage","insertLink"]],t.classes={focussed:"",toolbar:"ta-toolbar",toolbarGroup:"ta-button-group",toolbarButton:"",toolbarButtonActive:"active",disabled:"disabled",textEditor:"ta-text-editor",htmlEditor:"md-input"},t}]),t.decorator("taTools",["$delegate",function(t){return t.h1.display='<md-button aria-label="Heading 1">H1</md-button>',t.h2.display='<md-button aria-label="Heading 2">H2</md-button>',t.h3.display='<md-button aria-label="Heading 3">H3</md-button>',t.p.display='<md-button aria-label="Paragraph">P</md-button>',t.pre.display='<md-button aria-label="Pre">pre</md-button>',t.quote.display='<md-button class="md-icon-button" aria-label="Quote"><md-icon md-font-set="material-icons">format_quote</md-icon></md-button>',t.bold.display='<md-button class="md-icon-button" aria-label="Bold"><md-icon md-font-set="material-icons">format_bold</md-icon></md-button>',t.italics.display='<md-button class="md-icon-button" aria-label="Italic"><md-icon md-font-set="material-icons">format_italic</md-icon></md-button>',t.underline.display='<md-button class="md-icon-button" aria-label="Underline"><md-icon md-font-set="material-icons">format_underlined</md-icon></md-button>',t.ul.display='<md-button class="md-icon-button" aria-label="Buletted list"><md-icon md-font-set="material-icons">format_list_bulleted</md-icon></md-button>',t.ol.display='<md-button class="md-icon-button" aria-label="Numbered list"><md-icon md-font-set="material-icons">format_list_numbered</md-icon></md-button>',t.undo.display='<md-button class="md-icon-button" aria-label="Undo"><md-icon md-font-set="material-icons">undo</md-icon></md-button>',t.redo.display='<md-button class="md-icon-button" aria-label="Redo"><md-icon md-font-set="material-icons">redo</md-icon></md-button>',t.justifyLeft.display='<md-button class="md-icon-button" aria-label="Align left"><md-icon md-font-set="material-icons">format_align_left</md-icon></md-button>',t.justifyRight.display='<md-button class="md-icon-button" aria-label="Align right"><md-icon md-font-set="material-icons">format_align_right</md-icon></md-button>',t.justifyCenter.display='<md-button class="md-icon-button" aria-label="Align center"><md-icon md-font-set="material-icons">format_align_center</md-icon></md-button>',t.justifyFull.display='<md-button class="md-icon-button" aria-label="Justify"><md-icon md-font-set="material-icons">format_align_justify</md-icon></md-button>',t.clear.display='<md-button class="md-icon-button" aria-label="Clear formatting"><md-icon md-font-set="material-icons">format_clear</md-icon></md-button>',t.html.display='<md-button class="md-icon-button" aria-label="Show HTML"><md-icon md-font-set="material-icons">code</md-icon></md-button>',t.insertLink.display='<md-button class="md-icon-button" aria-label="Insert link"><md-icon md-font-set="material-icons">insert_link</md-icon></md-button>',t.insertImage.display='<md-button class="md-icon-button" aria-label="Insert photo"><md-icon md-font-set="material-icons">insert_photo</md-icon></md-button>',t}])}]);
"use strict";angular.module("atwork.chats").controller("ChatsCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appChats","appDialog","appDesktop",function(a,e,s,t,o,c,r,n,i,d,h,p){a.chats=[],a.actions={};var g={},u=function(){var s=0;_.each(a.chats,function(e){s+=e.unread}),p.notify({messagesCount:s})};a.message=function(e,s,a){var t;a?(a.unread=0,u(),t={chatId:a._id}):t={participants:[s._id,o.getUser()._id]},new d.single(t).$save(function(s){var t=s.res.record._id;g[s.res.record._id]=s.res.record,h.show({controller:["$scope","appDialog",function(a,e){u(),a.messages=s.res.record.messages,a.chatId=t,a.firstTime=!0,a.$on("chatMessage",function(e,s){a.$apply(function(){a.messages.unshift(s.chatMessage)}),i.conn.emit("markAccessed",{chatId:s.chatId,userId:o.getUser()._id})}),a.hide=function(){e.hide()},a.sendMessage=function(e){if(e){var s=a.message;a.message="",d.single.message({message:s,creator:o.getUser()._id,_id:a.chatId},function(e){a.messages.unshift(e.res.record.messages[0])})}}}],templateUrl:"/modules/chats/views/chat-dialog.html",targetEvent:e}).finally(function(){delete g[t]})})},a.updateChats=function(e){e=e||{};var s=d.single.get({},function(){e.reload&&(a.chats=[]),s.res.records.length&&(e.append?a.chats=a.chats.concat(s.res.records):a.chats=s.res.records.concat(a.chats)),u(),a.noMoreChats=!s.res.morePages,a.lastUpdated=Date.now()})},a.$on("chatMessage",function(e,s){g[s.chatId]||a.updateChats({reload:!0})})}]);
"use strict";angular.module("atwork.notifications").controller("notificationsCtrl",["$scope","$rootScope","appLocation","appUsers","appNotification","appWebSocket","appNotificationText","appDesktop",function(o,i,t,n,a,s,c,f){o.notificationShown=!1,o.notificationCount=0,o.items=[],i.$on("notification",function(i,t){o.updateNotifications()}),o.showUserNotifications=function(i){o.notificationShown=!o.notificationShown},o.markRead=function(i){var t=n.notifications.get({notificationId:i._id},function(){t.res.notifications&&t.res.notifications.map(function(i){i.display=c(i)}),o.items=t.res.notifications,o.notificationCount=t.res.notifications.length});o.showUserNotifications()},o.updateNotifications=function(){var i=n.notifications.get({},function(){i.res.notifications&&i.res.notifications.map(function(i){i.display=c(i),i.post?i.href="/post/"+i.post._id:i.user&&(i.href="/profile/"+i.actor.username)}),o.items=i.res.notifications,o.notificationCount=i.res.notifications?i.res.notifications.length:0,f.notify({notificationsCount:o.notificationCount})})},o.updateNotifications()}]);
"use strict";angular.module("atwork.posts").controller("PostsCtrl",["$scope","$route","$rootScope","$routeParams","$timeout","appPosts","appAuth","appToast","appStorage","appLocation","appWebSocket","appUsersSearch","appPostsFeed","resolvedFeeds",function(s,n,o,r,a,d,i,l,e,t,c,f,u,p){s.content="",s.lastUpdated=0,s.postForm="",s.newFeedCount=0,s.feed=[],s.feedsFilter="",s.limitComments=!0,s.feedPage=0,s.showBack=!1,s.mentionsResults=[];var m,g=r.hashtag,F=(s.timelinePage=r.userId,s.detailPage=r.postId,s.streamPage=r.streamId);function P(e){var t=e.config||{};s.feedsFilter&&!t.append&&(s.feed=[]),t.append?s.feed=s.feed.concat(e.res.records):s.feed=e.res.records.concat(s.feed),s.noMorePosts=!e.res.morePages,s.lastUpdated=Date.now(),s.showBack=!1,s.timelinePage?s.feedTitle="Timeline":s.streamPage?s.feedTitle="":s.detailPage?s.feedTitle="Written by "+s.feed[0].creator.name:s.feedTitle="Global"}g&&(s.feedsFilter="#"+g),s.back=function(){history.go(-1)},s.loadMore=function(){s.feedPage++,s.lastUpdated=0,s.feed.push({spacer:!0}),s.updateFeed({append:!0})},s.updateFeed=function(e,t){e=e||{};u.getFeeds(angular.extend(e,r,{passedData:t,feedsFilter:s.feedsFilter,limitComments:s.limitComments,feedPage:s.feedPage,lastUpdated:s.lastUpdated}),function(e){angular.extend(s,e.config),P(e)})},angular.extend(s,p.config),P(p),s.$watch("feedsFilter",function(e,t){e!==t&&(s.feed=[]),a.cancel(m),m=a(function(){e?(s.noPosting=!0,s.updateFeed()):s.feedsFilterEnabled&&(s.lastUpdated=0,s.noPosting=!1,console.log("hetre"),s.updateFeed()),s.feedsFilterEnabled=""!==s.feedsFilter},500)});var h=function(e,n){_.each(s.feed,function(e,t){e._id==n.postId&&function(e){var t={postId:n.postId};if(s.detailPage&&e._id===r.postId&&(t.allowMarking=!0),e._id==n.postId)var a=d.single.get(t,function(){angular.extend(e,a.res.record)})}(e)})};o.$on("like",h),o.$on("unlike",h),o.$on("comment",h),o.$on("feed",function(e,t){if(t.streamId||n.current.params.streamId){var a=n.current.params.streamId;a&&a===t.streamId?(s.newFeedCount++,s.$digest()):o.$broadcast("stream-message",t)}else s.newFeedCount++,s.$digest()}),s.reset=function(e){s.content="",a(function(){s.postForm.$setPristine(),s.postForm.$setUntouched()})};var $=null;s.checkMentions=function(e,t){if(e){var a=e.match(/@([A-Za-z0-9_]+)$/g);a&&1===a.length&&4<=a[0].length?f(a[0].replace("@",""),!1).then(function(e){s.mentionsResults=e.res.items}):s.mentionsResults=[],$=t;var n=angular.element($);angular.element(".mentions-results").css({top:n.offset().top})}},s.replaceName=function(e){var t=angular.element($);t.val(t.val().replace(/@([A-Za-z0-9_]+)$/g,"@"+e)+" "),a(function(){t.change(),t.focus(),s.mentionsResults=[]})},s.create=function(e,t){e&&new d.single({content:this.content,stream:F}).$save(function(e){e.success?(e.res=angular.extend(e.res,{creator:i.getUser()}),s.updateFeed(),s.reset()):(s.failure=!0,l(e.res.message))})}}]);
"use strict";angular.module("atwork.streams").controller("StreamsPurposeCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appStreams",function(a,e,t,r,s,o,n,u,c,m){var i=t.streamId;a.getStream=function(e){var t=m.single.get({streamId:e},function(){a.stream=t.res.record,a.stream.purpose=a.stream.purpose||"Set the stream's purpose here..."})},a.updateStreamPurpose=function(e){var t=m.single.get({streamId:i},function(){(t=angular.extend(t,a.stream)).$save(function(e){o("Stream purpose updated.")})})},i&&a.getStream(i)}]).controller("StreamsCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appStreams",function(r,e,t,a,s,o,n,u,c,m){r.streams=[],r.actions={},r.clearThis=function(e){console.log(r),console.log(e),a(function(){},2e3)},r.processMoreStreams=function(t){a(function(){if("1"===t)r.createNew();else var e=m.single.get({streamId:t},function(){e.$subscribe({streamId:t},function(){r.updateStreams({reload:!0}),o("You have subscribed to the new stream."),u.url("/stream/"+t)})})},500)},r.unsubscribe=function(e){var t=e._id,a=m.single.get({streamId:t},function(){a.$unsubscribe({streamId:t},function(){r.updateStreams({reload:!0}),o("You have unsubscribed from that stream.")})})},r.updateStreams=function(e){e=e||{};var t=m.single.get({subscribed:!0},function(){e.reload&&(r.streams=[]),e.append?r.streams=r.streams.concat(t.res.records):r.streams=t.res.records.concat(r.streams),r.noMoreStreams=!t.res.morePages,r.lastUpdated=Date.now()}),a=m.single.get({unsubscribed:!0},function(){r.moreStreams=a.res.records})},r.createNew=function(){r.actions.createNew=!0},r.create=function(e){e?new m.single({title:this.newStreamName}).$save(function(e){e.success?(c.conn.emit("stream",e.res._id),r.actions.createNew=!1,r.updateStreams({reload:!0}),u.url("/stream/"+e.res._id)):(r.failure=!0,o(e.res.message))}):o("Bummer! Is the stream name good?")},e.$on("stream-message",function(e,t){angular.forEach(r.streams,function(e){t.streamId===e._id&&(e.unread=e.unread?e.unread++:1)}),r.$digest()}),r.clearBadge=function(e){e.unread=0},c.conn.on("stream",function(){o("Woot! There is a new stream available!"),r.updateStreams({reload:!0})}),r.updateStreams()}]);
"use strict";angular.module("atwork.users").controller("ActivationCtrl",["$rootScope","$scope","$routeParams","appUsers","appToast","appStorage","appLocation",function(n,o,e,s,r,a,t){new s.auth({userId:e.userId,activationCode:e.activationCode}).$save(function(e){e.success?(r("Yayy! Your account is now active!"),o.postLogin(e.res.record,e.res.token)):r(e.res.message)}),o.postLogin=function(e,o){var s=angular.toJson(e);a.set("user",s),a.set("userToken",o),n.$broadcast("loggedIn"),t.url("/")}}]).controller("PasswordCtrl",["$rootScope","$scope","$routeParams","appUsers","appToast","appStorage","appLocation",function(n,o,e,s,r,a,t){new s.auth({userId:e.userId,activationCode:e.activationCode}).$save(function(e){e.success?(r("You are now logged in!"),o.postLogin(e.res.record,e.res.token)):r(e.res.message)}),o.postLogin=function(e,o){var s=angular.toJson(e);a.set("user",s),a.set("userToken",o),n.$broadcast("loggedIn"),t.url("/profile/"+e.username+"/change-password")}}]).controller("SearchCtrl",["$scope","$routeParams","$location","$timeout","$upload","appUsers","appAuth","appToast","appUsersSearch",function(e,o,s,n,r,a,t,i,u){e.search="",e.doSearch=function(e){return u(e).then(function(e){return e.res.items})},e.goToUser=function(e){e&&e.username&&s.url("/profile/"+e.username)},e.clearSearch=function(){n(function(){e.search=""},500)}}]).controller("ProfileCtrl",["$scope","$routeParams","$location","$timeout","$upload","appUsers","appAuth","appToast","appPosts","profileData","resolvedFeeds","appPostsFeed","appLocation",function(r,o,e,s,n,a,t,i,u,c,l,d,p){var f=o.userId||t.getUser()._id;if(r.selfProfile=f===t.getUser()._id||f===t.getUser().username,!f)return e.url("/");r.editProfile=function(){r.editMode=!0},r.changePassword=function(){p.url("/profile/"+t.getUser().username+"/change-password")},r.cancelEditProfile=function(){r.editMode=!1},r.updateProfile=function(e){if(e){if(r.password&&r.password!==r.password2)return i("Passwords do not match.");var o=a.single.get({userId:f},function(){o.name=r.profile.name,o.designation=r.profile.designation,r.password&&(o.password=r.password),delete o.res,o.$update(function(e){e.success?(r.editMode=!1,r.password&&p.url("/profile/"+e.res.username)):(r.failure=!0,i(e.res.message))})})}else i("Something is missing.")};var g=function(e){f=e.res.record.username,e.res.profile=e.res.record,angular.extend(r,e.res)};function m(e){var o=e.config||{};r.feedsFilter&&!o.append&&(r.feed=[]),o.append?r.feed=r.feed.concat(e.res.records):r.feed=e.res.records.concat(r.feed),r.noMorePosts=!e.res.morePages,r.lastUpdated=Date.now(),r.showBack=!1}r.getProfile=function(){a.single.get({userId:f}).$promise.then(function(e){g(e)})},r.noPosting=!0,r.loadMore=function(){r.feedPage=r.feedPage||0,r.feedPage++,r.lastUpdated=0,r.feed.push({spacer:!0}),r.updateFeed({append:!0})},r.updateFeed=function(e){e=e||{};d.getFeeds(angular.extend(e,o,{limitComments:!0,feedPage:r.feedPage}),function(e){angular.extend(r,e.config),m(e)})},r.follow=function(){r.alreadyFollowing="",new a.single({userId:f}).$follow({userId:f},function(){s(function(){r.getProfile()},800)})},r.unfollow=function(){r.alreadyFollowing="",new a.single({userId:f}).$unfollow({userId:f},function(e){s(function(){r.getProfile()},800)})},r.$watch("avatar",function(){r.avatar&&r.avatar.length&&r.uploadAvatar(r.avatar)}),r.uploadAvatar=function(){if(!r.selfProfile)return!0;var e=r.avatar.pop();n.upload({url:"/users/"+f+"/avatar",file:e}).progress(function(e){var o=parseInt(100*e.loaded/e.total);console.log("progress: "+o+"% "+e.config.file.name)}).success(function(e,o,s,n){e&&e.success&&(r.profile.face=e.res.face)})},g(c),angular.extend(r,l.config),m(l)}]).controller("InviteCtrl",["$rootScope","$scope","appStorage","appLocation","appDialog","appUsers","appAuth","appToast",function(e,o,s,n,r,a,t,i){o.inviteOthers=function(e){r.show({controller:["$scope","appDialog",function(s,e){s.inviteDone=!1,s.doInvite=function(e){if(e){var o=t.getUser()._id;new a.single({userId:o,message:s.message,email:s.email,name:s.name}).$invite({userId:o},function(e){e.success?s.inviteDone=!0:i(e.res.message)})}},s.hide=function(){e.hide()}}],templateUrl:"/modules/users/views/users-invite-dialog.html",targetEvent:e})}}]).controller("LogoutCtrl",["$rootScope","appStorage","appLocation",function(e,o,s){o.remove("userToken"),o.remove("user"),e.$broadcast("loggedOut"),s.url("/login")}]).controller("LoginCtrl",["$scope","$rootScope","appUsers","appAuth","appToast","appStorage","appLocation","appDialog",function(o,n,s,e,r,a,t,i){o.reset=function(){o.name=o.email=o.password=o.password2=o.name=""},o.create=function(e){e?new s.single({email:this.email,name:this.name,username:this.username,designation:this.designation,password:this.password}).$save(function(e){o.registeredUserId=e.res._id,e.success?e.res&&e.res.record&&e.res.record.active?o.postLogin(e.res.record,e.res.token):o.regDone=!0:(o.failure=!0,r(e.res.message))}):r("Something is missing.")},o.resendEmail=function(){new s.single({userId:o.registeredUserId}).$activate({userId:o.registeredUserId},function(){r("Success! An email has been sent to you again.")})},o.forgotPwd=function(e){i.show({controller:["$scope","appDialog",function(o,e){o.inviteDone=!1,o.doReset=function(e){e&&new s.single({email:o.email}).$resetPassword({email:o.email},function(e){e.success?o.submitDone=!0:r(e.res.message)})},o.hide=function(){e.hide()}}],templateUrl:"/modules/users/views/users-pwd-dialog.html",targetEvent:e})},o.login=function(e){e?new s.auth({email:this.email,password:this.password}).$save(function(e){e.success?(r("You are now logged in."),o.postLogin(e.res.record,e.res.token)):r(e.res.message)}):r("Something is missing.")},o.postLogin=function(e,o){var s=angular.toJson(e);a.set("user",s),a.set("userToken",o),n.$broadcast("loggedIn"),t.url("/")},e.isLoggedIn()&&t.url("/")}]).controller("UserSheet",["$scope","$mdBottomSheet","$location","appStorage",function(s,n,e,o){s.items=[{name:"Profile",icon:"fa-user",handler:function(){e.url("/profile/"+angular.fromJson(o.get("user")).username)}},{name:"Logout",icon:"fa-sign-out",handler:function(){e.url("/logout")}}],s.listItemClick=function(e){var o=s.items[e];n.hide(o),o.handler()}}]);
"use strict";angular.module("atwork.activities").factory("appActivities",["$resource",function(e){return e("activities/feed/:userId",{userId:"@_id"})}]);
"use strict";angular.module("atwork.blogs").factory("appBlogs",["$resource",function(e){return{single:e("blogs/:blogId/:action",{blogId:"@_id"}),feed:e("blogs/")}}]).filter("htmlToPlaintext",function(){return function(e){return(e=String(e).replace(/<[^>]+>/gm,"").replace(/&nbsp;/g,""))||""}}).filter("appBlogPostFormat",["$sce",function(r){return function(e){var t=new RegExp("#([A-Za-z0-9]+)","g");e=e.replace(t,function(e){return'<a href="/feed/'+e.replace("#","")+'">'+e+"</a>"});var n=new RegExp("@([A-Za-z0-9_]+)","g");e=e.replace(n,function(e){return'<a href="/profile/'+e.replace("@","")+'">'+e+"</a>"});var o=[{key:":)",value:"fa-smile-o"},{key:":|",value:"fa-meh-o"},{key:":(",value:"fa-frown-o"},{key:"(y)",value:"fa-thumbs-o-up"},{key:"(n)",value:"fa-thumbs-o-down"},{key:":+1",value:"fa-thumbs-up"},{key:"(h)",value:"fa-heart"},{key:"(i)",value:"fa-lightbulb-o"}];for(var i in o){var l=o[i].key,a=o[i].value;e=e.replace(l,'<md-inline-list-icon class="yellow fa {{emoticon}}"></md-inline-list-icon>'.replace("{{emoticon}}",a))}return r.trustAsHtml(e)}}]).factory("appBlogsFeed",["appBlogs",function(c){return{getBlogs:function(e,t){var n=(e=e||{}).userId,o=(e.hashtag,e.postId),i=e.streamId,l=e.passedData,a=e;if(n){a.noPosting=!0,a.limitComments=!0;var r=c.timeline.get({userId:n,timestamp:a.lastUpdated,filter:a.feedsFilter,limitComments:a.limitComments,page:a.feedPage},function(){u(r)})}else if(i){a.limitComments=!0;var s=c.stream.get({streamId:i,timestamp:a.lastUpdated,filter:a.feedsFilter,limitComments:a.limitComments,page:a.feedPage},function(){u(s)})}else if(o){a.noFiltering=!0,a.noPosting=!0,a.noMorePosts=!0,delete a.limitComments;r=c.single.get({postId:o,limitComments:a.limitComments,allowMarking:!0},function(){r.res.records=[r.res.record],u(r),a.lastUpdated=Date.now(),a.showBack=!0})}else{a.limitComments=!0;var m=c.feed.get({timestamp:a.lastUpdated,filter:a.feedsFilter,limitComments:a.limitComments,page:a.feedPage},function(){u(m)})}function u(e){a.lastUpdated=Date.now(),e.config=a,t(e)}l&&u(l),a.newFeedCount=0}}}]).directive("awBlogItem",["appBlogs","appWebSocket","appAuth","appDialog",function(o,e,i,l){return{templateUrl:"/modules/blogs/views/blog-single.html",controller:["$scope",function(e){e.doLike=function(t){t.liked=!0,o.single.like(t,function(e){angular.extend(t,e.res.record)})},e.undoLike=function(t){t.liked=!1,o.single.unlike(t,function(e){angular.extend(t,e.res.record)})},e.comment=function(e,t){if(e){var n=this.content;t.commentEnabled=!1,t.comments.unshift({creator:i.getUser(),content:n}),t.comment=n,o.single.comment(t,function(e){angular.extend(t,e.res.record),t.commentEnabled=!1})}},e.showLikers=function(e,t){o.single.likes({postId:t._id},function(n){l.show({controller:["$scope","appDialog",function(e,t){e.users=n.res.records,e.hide=function(){t.hide()}}],templateUrl:"/modules/users/views/users-dialog.html",targetEvent:e})})}}]}}]);
"use strict";angular.module("atwork.chats").factory("appChats",["$resource",function(a){return{single:a("chats/:chatId/:action",{chatId:"@_id"},{message:{method:"POST",params:{action:"message"}},end:{method:"POST",params:{action:"end"}}})}}]);
"use strict";angular.module("atwork.notifications").factory("appNotification",["$resource","$mdToast",function(t,i){return{show:function(t){if(t.message){var o=i.simple().content(t.message).action("VIEW").highlightAction(!1).position("bottom right");i.show(o).then(function(){t.then&&t.then()}),window.fluid&&window.fluid.showGrowlNotification({title:"Atwork",description:t.message,priority:1,sticky:!1,identifier:"foo",onclick:function(){},icon:imgEl})}}}}]).factory("appNotificationText",[function(){return function(t){if(!t)return{text:""};var o="",i=t.actor;switch(t.notificationType){case"like":o=i.name+" has liked a post";break;case"comment":o=i.name+" has commented on a post";break;case"follow":o=i.name+" is now following you";break;case"mention":o=i.name+" mentioned you in a post"}return{text:o}}}]);
"use strict";angular.module("atwork.posts").factory("appPosts",["$resource",function(e){return{single:e("posts/:postId/:action",{postId:"@_id"},{like:{method:"POST",params:{action:"like"}},unlike:{method:"POST",params:{action:"unlike"}},comment:{method:"POST",params:{action:"comment"}},likes:{method:"GET",params:{action:"likes"}}}),feed:e("posts/"),stream:e("posts/stream/:streamId"),timeline:e("posts/timeline/:userId")}}]).filter("appPostFormat",["$sce",function(r){return function(e){var t=new RegExp("#([A-Za-z0-9]+)","g");e=e.replace(t,function(e){return'<a href="/feed/'+e.replace("#","")+'">'+e+"</a>"});var n=new RegExp("@([A-Za-z0-9_]+)","g");e=e.replace(n,function(e){return'<a href="/profile/'+e.replace("@","")+'">'+e+"</a>"});var o=[{key:":)",value:"fa-smile-o"},{key:":|",value:"fa-meh-o"},{key:":(",value:"fa-frown-o"},{key:"(y)",value:"fa-thumbs-o-up"},{key:"(n)",value:"fa-thumbs-o-down"},{key:":+1",value:"fa-thumbs-up"},{key:"(h)",value:"fa-heart"},{key:"(i)",value:"fa-lightbulb-o"}];for(var i in o){var s=o[i].key,a=o[i].value;e=e.replace(s,'<md-inline-list-icon class="yellow fa {{emoticon}}"></md-inline-list-icon>'.replace("{{emoticon}}",a))}return r.trustAsHtml(e)}}]).factory("appPostsFeed",["appPosts",function(u){return{getFeeds:function(e,t){var n=(e=e||{}).userId,o=(e.hashtag,e.postId),i=e.streamId,s=e.passedData,a=e;if(n){a.noPosting=!0,a.limitComments=!0;var r=u.timeline.get({userId:n,timestamp:a.lastUpdated,filter:a.feedsFilter,limitComments:a.limitComments,page:a.feedPage},function(){c(r)})}else if(i){a.limitComments=!0;var l=u.stream.get({streamId:i,timestamp:a.lastUpdated,filter:a.feedsFilter,limitComments:a.limitComments,page:a.feedPage},function(){c(l)})}else if(o){a.noFiltering=!0,a.noPosting=!0,a.noMorePosts=!0,delete a.limitComments;r=u.single.get({postId:o,limitComments:a.limitComments,allowMarking:!0},function(){r.res.records=[r.res.record],c(r),a.lastUpdated=Date.now(),a.showBack=!0})}else{a.limitComments=!0;var m=u.feed.get({timestamp:a.lastUpdated,filter:a.feedsFilter,limitComments:a.limitComments,page:a.feedPage},function(){c(m)})}function c(e){a.lastUpdated=Date.now(),e.config=a,t(e)}s&&c(s),a.newFeedCount=0}}}]).directive("awFeedItem",["appPosts","appWebSocket","appAuth","appDialog",function(o,e,i,s){return{templateUrl:"/modules/posts/views/post-single.html",controller:["$scope",function(e){e.doLike=function(t){t.liked=!0,o.single.like(t,function(e){angular.extend(t,e.res.record)})},e.undoLike=function(t){t.liked=!1,o.single.unlike(t,function(e){angular.extend(t,e.res.record)})},e.comment=function(e,t){if(e){var n=this.content;t.commentEnabled=!1,t.comments.unshift({creator:i.getUser(),content:n}),t.comment=n,o.single.comment(t,function(e){angular.extend(t,e.res.record),t.commentEnabled=!1})}},e.showLikers=function(e,t){o.single.likes({postId:t._id},function(n){s.show({controller:["$scope","appDialog",function(e,t){e.users=n.res.records,e.hide=function(){t.hide()}}],templateUrl:"/modules/users/views/users-dialog.html",targetEvent:e})})}}]}}]);
"use strict";angular.module("atwork.streams").factory("appStreams",["$resource",function(s){return{single:s("streams/:streamId/:action",{streamId:"@_id"},{subscribe:{method:"POST",params:{action:"subscribe"}},unsubscribe:{method:"POST",params:{action:"unsubscribe"}}})}}]);
"use strict";angular.module("atwork.users").factory("appUsers",["$resource",function(r){return{single:r("users/:userId/:action",{userId:"@_id"},{update:{method:"PUT"},follow:{method:"POST",params:{action:"follow"}},unfollow:{method:"POST",params:{action:"unfollow"}},activate:{method:"POST",params:{action:"activate"}},invite:{method:"POST",params:{action:"invite"}},resetPassword:{method:"POST",params:{action:"resetPassword"}}}),auth:r("users/authenticate"),notifications:r("users/notifications/:notificationId")}}]).factory("appUsersSearch",["$resource",function(r){var a=r("users/search/:keyword",{},{query:{isArray:!1}});return function(r,e){var o={keyword:r};return e&&(o.onlyUsernames=!0),a.query(o).$promise}}]).factory("follow");
"use strict";angular.module("atwork.activities").config(["$routeProvider","$locationProvider",function(o,i){i.html5Mode(!0)}]);
"use strict";function resolvedBlogs(t){return["$route","appBlogsFeed",function(e,o){var l=Q.defer(),r=angular.extend({limitComments:t.limitComments},e.current.params);return o.getBlogs(r,function(e){l.resolve(e)}),l.promise}]}angular.module("atwork.blogs").config(["$routeProvider","$locationProvider",function(e,o){e.when("/blog",{templateUrl:"/modules/blogs/views/blogs.html",controller:"BlogsCtrl",resolve:{resolvedBlogs:resolvedBlogs({limitComments:!0})}}).when("/blog/add",{templateUrl:"/modules/blogs/views/add-blog.html",controller:"BlogsCtrl",resolve:{resolvedBlogs:resolvedBlogs({limitComments:!0})}}),o.html5Mode(!0)}]);
"use strict";angular.module("atwork.chats").config(["$routeProvider","$locationProvider",function(o,r){r.html5Mode(!0)}]);
"use strict";function resolvedFeeds(l){return["$route","appPostsFeed",function(e,s){var t=Q.defer(),o=angular.extend({limitComments:l.limitComments},e.current.params);return s.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}angular.module("atwork.posts").config(["$routeProvider","$locationProvider",function(e,s){e.when("/feed",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!0})}}).when("/",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!0})}}).when("/post/:postId",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!1})}}).when("/feed/:hashtag",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!0})}}),s.html5Mode(!0)}]);
"use strict";angular.module("atwork.streams").config(["$routeProvider","$locationProvider",function(e,r){e.when("/stream/:streamId",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:["$route","appPostsFeed",function(e,r){var t=Q.defer(),o=angular.extend({limitComments:!0},e.current.params);return r.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}}),r.html5Mode(!0)}]);
"use strict";angular.module("atwork.users").config(["$routeProvider","$locationProvider",function(e,r){e.when("/login",{templateUrl:"/modules/users/views/login.html?v",controller:"LoginCtrl"}).when("/logout",{templateUrl:"/modules/users/views/login.html?v",controller:"LogoutCtrl"}).when("/activate/:userId/:activationCode",{templateUrl:"/modules/users/views/activating.html",controller:"ActivationCtrl"}).when("/changePassword/:userId/:activationCode",{templateUrl:"/modules/users/views/change-password.html",controller:"PasswordCtrl"}).when("/profile/:userId/change-password",{templateUrl:"/modules/users/views/change-password.html",controller:"ProfileCtrl",resolve:{profileData:["$route","appAuth","appUsers",function(e,r,t){var o=e.current.params.userId||r.getUser()._id;return t.single.get({userId:o}).$promise}],resolvedFeeds:["$route","appPostsFeed",function(e,r){var t=Q.defer(),o=angular.extend({feedPage:0},e.current.params);return r.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}}).when("/profile/:userId",{templateUrl:"/modules/users/views/profile.html?v",controller:"ProfileCtrl",resolve:{profileData:["$route","appAuth","appUsers",function(e,r,t){var o=e.current.params.userId||r.getUser()._id;return t.single.get({userId:o}).$promise}],resolvedFeeds:["$route","appPostsFeed",function(e,r){var t=Q.defer(),o=angular.extend({feedPage:0},e.current.params);return r.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}}).when("/me",{templateUrl:"/modules/users/views/profile.html?v",controller:"ProfileCtrl"}),r.html5Mode(!0)}]);
var app=angular.module("AtWork",["atwork.system","atwork.users","atwork.posts","atwork.streams","atwork.blogs","atwork.chats","atwork.activities","atwork.notifications","atwork.settings","ngMaterial"]);app.controller("AppCtrl",["$scope","$route","$rootScope","$mdSidenav","$mdBottomSheet","$location","$timeout","appLocation","appAuth","appWebSocket","appSettings","appSettingsValid","appToast",function(e,t,o,n,a,i,s,r,c,l,u,g,p){e.barTitle="",e.search="",e.toggleSidenav=function(t){n(t).toggle()},e.updateLoginStatus=function(){e.isLoggedIn=c.isLoggedIn(),e.user=c.getUser()},e.goHome=function(){r.url("/")},e.showUserActions=function(t){a.show({templateUrl:"/modules/users/views/user-list.html",controller:"UserSheet",targetEvent:t}).then(function(t){e.alert=t.name+" clicked!"})};var d=function(e){u.fetch(function(t){o.systemSettings=t,e&&e()})};e.$on("$routeChangeSuccess",function(){angular.element("*[md-scroll-y]").animate({scrollTop:0},300),n("left").close()}),e.$on("loggedIn",function(){e.updateLoginStatus(),e.barTitle="",e.$broadcast("updateNotifications"),l.conn.emit("online",{token:c.getToken()}),c.refreshUser(function(t){e.user=t}),d(function(){e.$on("$routeChangeStart",function(t,e){g()||p("Please complete the setup first.")}),e.appReady=!0,e.barTitle=o.systemSettings.tagline,s(g)})}),e.$on("loggedOut",function(){e.updateLoginStatus(),l.conn.emit("logout",{token:c.getToken()})}),l.conn.on("connect",function(){c.isLoggedIn()&&l.conn.emit("online",{token:c.getToken()})}),e.updateLoginStatus(),s(function(){c.isLoggedIn()?(e.barTitle="",e.$broadcast("loggedIn")):(-1==window.location.href.indexOf("/activate/")&&-1==window.location.href.indexOf("/changePassword/")&&r.url("/login"),d(),e.appReady=!0)})}]);